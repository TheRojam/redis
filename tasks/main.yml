---
- name: Add redis ppa
  apt_repository:
    repo: "ppa:chris-lea/redis-server"
  when: ansible_pkg_mgr == "apt"

- name: Update Cache (apt)
  apt:
    update_cache: yes
  changed_when: false
  when: ansible_pkg_mgr == "apt"

- name: Install redis-server (apt)
  apt:
    name: redis-server
  when: ansible_pkg_mgr == "apt"

- name: Update repositories cache (pacman)
  pacman:
    update_cache: yes
  changed_when: false
  when: ansible_pkg_mgr == "pacman"

- name: Install required packages (pacman)
  pacman:
    name: redis
  when: ansible_pkg_mgr == "pacman"

- name: Install systemd service file
  template:
    src: systemd-redis.service.j2
    dest: /etc/systemd/system/redis.service
  notify: Reload systemd daemon

- name: Remove redis-server.service
  file:
    state: absent
    path: /lib/systemd/system/redis-server.service

- name: Copy Redis conf 
  template:
    src: redis.conf.j2
    dest: /etc/redis/redis.conf
    owner: root
    group: root
    mode: 0644
  when: ansible_pkg_mgr == "apt"
  notify: Restart redis

- name: Copy Redis conf 
  template:
    src: redis.conf.j2
    dest: /etc/redis.conf
    owner: root
    group: root
    mode: 0644
  when: ansible_pkg_mgr == "pacman"
  notify: Restart redis
